<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SUDOKU VAULT</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&display=swap');
        
        * {
            font-family: 'Space Mono', monospace;
        }

        body {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #e0e0e0;
        }

        .sudoku-grid {
            display: grid;
            grid-template-columns: repeat(9, 1fr);
            gap: 0;
            border: 3px solid #00ff88;
            background: #0f0f0f;
            box-shadow: 0 0 20px rgba(0, 255, 136, 0.3);
        }

        .cell {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            font-weight: bold;
            cursor: pointer;
            border: 1px solid #333;
            background: #1a1a1a;
            color: #00ff88;
            transition: all 0.15s ease;
        }

        .cell:hover:not(.fixed) {
            background: #2a2a2a;
            box-shadow: inset 0 0 10px rgba(0, 255, 136, 0.2);
        }

        .cell.selected {
            background: #00ff88;
            color: #0f0f0f;
            box-shadow: 0 0 15px rgba(0, 255, 136, 0.8);
            font-weight: bold;
        }

        .cell.fixed {
            background: #0a0a0a;
            color: #ffaa00;
            pointer-events: none;
            font-weight: bold;
        }

        .cell:nth-child(3n) {
            border-right: 2px solid #00ff88;
        }

        .cell:nth-child(9n) {
            border-right: 1px solid #333;
        }

        .sudoku-grid > div:nth-child(n+19):nth-child(-n+27),
        .sudoku-grid > div:nth-child(n+46):nth-child(-n+54) {
            border-bottom: 2px solid #00ff88;
        }

        .btn-num {
            background: linear-gradient(135deg, #00ff88 0%, #00dd77 100%);
            color: #0f0f0f;
            font-weight: bold;
            border: 2px solid #00ff88;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 4px 15px rgba(0, 255, 136, 0.2);
        }

        .btn-num:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 255, 136, 0.4);
        }

        .btn-num:active {
            transform: translateY(0);
            box-shadow: inset 0 4px 10px rgba(0, 0, 0, 0.3);
        }

        .btn-clear {
            background: linear-gradient(135deg, #ff4757 0%, #ff3838 100%);
            color: white;
            border: 2px solid #ff4757;
        }

        .btn-clear:hover {
            box-shadow: 0 6px 20px rgba(255, 71, 87, 0.4);
        }

        .btn-admin {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: 2px solid #667eea;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: bold;
        }

        .btn-admin:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }

        .timer {
            font-size: 2rem;
            font-weight: bold;
            color: #00ff88;
            text-shadow: 0 0 10px rgba(0, 255, 136, 0.5);
        }

        .countdown {
            font-size: 4rem;
            font-weight: bold;
            color: #00ff88;
            text-shadow: 0 0 15px rgba(0, 255, 136, 0.8);
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .lock-icon {
            width: 80px;
            height: 80px;
            border: 3px solid #00ff88;
            border-radius: 10px;
            position: relative;
            animation: spin 3s linear infinite;
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .win-screen {
            background: linear-gradient(135deg, #00ff88 0%, #00dd77 100%);
            color: #0f0f0f;
        }

        input[type="number"],
        input[type="datetime-local"],
        textarea {
            background: #1a1a2e;
            border: 2px solid #00ff88;
            color: #00ff88;
            padding: 8px 12px;
            border-radius: 4px;
            font-family: 'Space Mono', monospace;
        }

        input[type="number"]:focus,
        input[type="datetime-local"]:focus,
        textarea:focus {
            outline: none;
            box-shadow: 0 0 15px rgba(0, 255, 136, 0.5);
        }

        input[type="datetime-local"]::-webkit-calendar-picker-indicator {
            filter: invert(1) brightness(0.8) sepia(1) hue-rotate(90deg) saturate(5);
        }

        .section-title {
            color: #00ff88;
            font-size: 0.8rem;
            font-weight: bold;
            letter-spacing: 2px;
            text-shadow: 0 0 10px rgba(0, 255, 136, 0.3);
            margin-bottom: 1rem;
        }
    </style>
</head>
<body class="min-h-screen">

    <!-- ADMIN VIEW -->
    <div id="admin-view" class="hidden min-h-screen p-8">
        <div class="max-w-2xl mx-auto">
            <div class="mb-8">
                <h1 class="text-5xl font-bold mb-2" style="color: #667eea;">SUDOKU</h1>
                <p class="text-sm" style="color: #764ba2;">VAULT CONFIGURATION PANEL</p>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-8">
                <!-- Difficulty Settings -->
                <div class="bg-gradient-to-br from-[#16213e] to-[#0f3460] p-6 rounded-lg border-2" style="border-color: #667eea;">
                    <p class="section-title">DIFFICULTY PARAMETERS</p>
                    
                    <div class="space-y-4">
                        <div>
                            <label class="text-sm text-gray-400 block mb-1">MIN DIFFICULTY (0.0-1.0)</label>
                            <input type="number" id="minDiff" value="0.3" step="0.1" min="0" max="1" class="w-full">
                        </div>
                        <div>
                            <label class="text-sm text-gray-400 block mb-1">MAX DIFFICULTY (0.0-1.0)</label>
                            <input type="number" id="maxDiff" value="0.8" step="0.1" min="0" max="1" class="w-full">
                        </div>
                        <div>
                            <label class="text-sm text-gray-400 block mb-1">TARGET CLUES (17-81)</label>
                            <input type="number" id="numClues" value="35" min="17" max="81" class="w-full">
                        </div>
                    </div>
                </div>

                <!-- Temporal Lock -->
                <div class="bg-gradient-to-br from-[#16213e] to-[#0f3460] p-6 rounded-lg border-2" style="border-color: #667eea;">
                    <p class="section-title">TEMPORAL LOCK</p>
                    
                    <div class="space-y-4">
                        <div>
                            <label class="text-sm text-gray-400 block mb-1">UNLOCK TIME</label>
                            <input type="datetime-local" id="startTime" class="w-full">
                        </div>
                        <button onclick="setUnlockTime()" class="w-full btn-admin py-2 rounded">SET CURRENT + 5 MIN</button>
                    </div>
                </div>
            </div>

            <!-- Generate Button -->
            <button onclick="generatePuzzle()" class="w-full btn-admin py-4 rounded text-lg mb-8">GENERATE & ENCODE PUZZLE</button>

            <!-- Output -->
            <div id="output" class="hidden bg-gradient-to-br from-[#16213e] to-[#0f3460] p-6 rounded-lg border-2" style="border-color: #00ff88;">
                <p class="section-title">PAYLOAD READY</p>
                <textarea id="url-box" readonly class="w-full h-32 mb-4 resize-none" style="color: #00ff88;"></textarea>
                <div class="grid grid-cols-2 gap-4">
                    <button onclick="copyURL()" class="btn-admin py-2 rounded">COPY LINK</button>
                    <button onclick="openPreview()" class="btn-admin py-2 rounded">OPEN PREVIEW</button>
                </div>
            </div>
        </div>
    </div>

    <!-- PLAYER VIEW -->
    <div id="player-view" class="hidden min-h-screen flex flex-col items-center p-4 md:p-8">
        <!-- Header -->
        <div class="w-full max-w-md mb-8 flex justify-between items-center pb-4" style="border-bottom: 2px solid #00ff88;">
            <div>
                <h1 class="text-3xl font-bold" style="color: #00ff88;">VAULT_SYS</h1>
                <p id="diff-label" class="text-xs text-gray-400 uppercase tracking-widest">Security Level 5</p>
            </div>
            <div class="timer" id="timer-display">00:00</div>
        </div>

        <!-- LOCK SCREEN -->
        <div id="lock-screen" class="flex-1 flex flex-col items-center justify-center space-y-8 w-full">
            <div class="lock-icon"></div>
            <div class="text-center">
                <p class="text-sm uppercase tracking-widest mb-4" style="color: #00ff88;">Temporal Lock Active</p>
                <p class="countdown" id="countdown">--s</p>
            </div>
        </div>

        <!-- GAME SCREEN -->
        <div id="game-screen" class="hidden flex-1 w-full max-w-md flex flex-col items-center justify-center">
            <div class="sudoku-grid w-full mb-8"></div>
            
            <div class="grid grid-cols-5 gap-2 w-full">
                <button onclick="inputValue(1)" class="btn-num py-3 rounded">1</button>
                <button onclick="inputValue(2)" class="btn-num py-3 rounded">2</button>
                <button onclick="inputValue(3)" class="btn-num py-3 rounded">3</button>
                <button onclick="inputValue(4)" class="btn-num py-3 rounded">4</button>
                <button onclick="inputValue(5)" class="btn-num py-3 rounded">5</button>
                <button onclick="inputValue(6)" class="btn-num py-3 rounded">6</button>
                <button onclick="inputValue(7)" class="btn-num py-3 rounded">7</button>
                <button onclick="inputValue(8)" class="btn-num py-3 rounded">8</button>
                <button onclick="inputValue(9)" class="btn-num py-3 rounded">9</button>
                <button onclick="inputValue(0)" class="btn-clear py-3 rounded text-xs">CLEAR</button>
            </div>
        </div>

        <!-- WIN SCREEN -->
        <div id="win-screen" class="hidden fixed inset-0 win-screen z-50 flex flex-col items-center justify-center p-8 text-center">
            <h2 class="text-7xl font-black mb-4">UNLOCKED</h2>
            <p class="text-2xl font-bold uppercase tracking-widest mb-8 opacity-80">Vault Access Granted</p>
            <p class="text-5xl font-black mb-12" id="final-time">00s</p>
            <button onclick="location.reload()" class="btn-admin px-8 py-4 rounded text-lg">RESTART</button>
        </div>
    </div>

    <script>
        // ===== SUDOKU LOGIC =====
        const Logic = {
            isValid: (board, r, c, val) => {
                // Check row and column
                for (let i = 0; i < 9; i++) {
                    if (board[r][i] === val || board[i][c] === val) return false;
                }
                // Check 3x3 box
                const sr = Math.floor(r / 3) * 3;
                const sc = Math.floor(c / 3) * 3;
                for (let i = 0; i < 3; i++) {
                    for (let j = 0; j < 3; j++) {
                        if (board[sr + i][sc + j] === val) return false;
                    }
                }
                return true;
            },

            solve: (board) => {
                for (let r = 0; r < 9; r++) {
                    for (let c = 0; c < 9; c++) {
                        if (board[r][c] === 0) {
                            for (let n = 1; n <= 9; n++) {
                                if (Logic.isValid(board, r, c, n)) {
                                    board[r][c] = n;
                                    if (Logic.solve(board)) return true;
                                    board[r][c] = 0;
                                }
                            }
                            return false;
                        }
                    }
                }
                return true;
            },

            generate: (numClues) => {
                const board = Array(9).fill().map(() => Array(9).fill(0));
                Logic.solve(board);
                
                let puzzle = board.map(row => [...row]);
                let removed = 0;
                let attempts = 0;
                const targetEmpty = 81 - numClues;

                while (removed < targetEmpty && attempts < 1000) {
                    const r = Math.floor(Math.random() * 9);
                    const c = Math.floor(Math.random() * 9);
                    
                    if (puzzle[r][c] !== 0) {
                        const val = puzzle[r][c];
                        puzzle[r][c] = 0;
                        removed++;
                    }
                    attempts++;
                }

                return puzzle.flat().map(v => v === 0 ? '0' : v.toString()).join('');
            }
        };

        // ===== STATE =====
        let state = {
            puzzle: '',
            currentGrid: [],
            solution: [],
            selected: [0, 0],
            startTime: 0,
            gameStartTime: 0,
            isLocked: true
        };

        // ===== INITIALIZATION =====
        function init() {
            const params = new URLSearchParams(window.location.search);
            const p = params.get('p');
            const t = params.get('t');

            if (p && t) {
                state.puzzle = p;
                state.startTime = parseInt(t) * 1000;
                state.currentGrid = p.split('').map(Number);
                document.getElementById('player-view').classList.remove('hidden');
                renderGrid();
                tick();
            } else {
                document.getElementById('admin-view').classList.remove('hidden');
                setUnlockTime();
            }
        }

        // ===== ADMIN FUNCTIONS =====
        function setUnlockTime() {
            const now = new Date();
            now.setMinutes(now.getMinutes() + 5);
            document.getElementById('startTime').value = now.toISOString().slice(0, 16);
        }

        function generatePuzzle() {
            const clues = parseInt(document.getElementById('numClues').value);
            const p = Logic.generate(clues);
            const t = Math.floor(new Date(document.getElementById('startTime').value).getTime() / 1000);
            const url = `${window.location.origin}${window.location.pathname}?p=${p}&t=${t}`;
            
            document.getElementById('output').classList.remove('hidden');
            document.getElementById('url-box').textContent = url;
        }

        function copyURL() {
            const text = document.getElementById('url-box').textContent;
            navigator.clipboard.writeText(text).then(() => {
                alert('URL copied to clipboard!');
            });
        }

        function openPreview() {
            const url = document.getElementById('url-box').textContent;
            window.open(url, '_blank');
        }

        // ===== PLAYER FUNCTIONS =====
        function renderGrid() {
            const container = document.querySelector('.sudoku-grid');
            container.innerHTML = '';
            state.currentGrid.forEach((val, i) => {
                const r = Math.floor(i / 9);
                const c = i % 9;
                const cell = document.createElement('div');
                cell.className = 'cell';
                
                if (state.puzzle[i] !== '0') {
                    cell.classList.add('fixed');
                }
                
                if (state.selected[0] === r && state.selected[1] === c) {
                    cell.classList.add('selected');
                }
                
                cell.textContent = val !== 0 ? val : '';
                cell.onclick = () => {
                    if (!state.isLocked && state.puzzle[i] === '0') {
                        state.selected = [r, c];
                        renderGrid();
                    }
                };
                
                container.appendChild(cell);
            });
        }

        function inputValue(val) {
            const idx = state.selected[0] * 9 + state.selected[1];
            if (state.puzzle[idx] !== '0') return;
            state.currentGrid[idx] = val;
            renderGrid();
            checkWin();
        }

        function checkWin() {
            if (!state.currentGrid.includes(0)) {
                document.getElementById('win-screen').classList.remove('hidden');
                const elapsed = Math.floor((Date.now() - state.gameStartTime) / 1000);
                document.getElementById('final-time').textContent = elapsed + 's';
            }
        }

        function tick() {
            const now = Date.now();
            const diff = state.startTime - now;
            
            if (diff > 0) {
                document.getElementById('countdown').textContent = Math.ceil(diff / 1000) + 's';
                setTimeout(tick, 100);
            } else {
                state.isLocked = false;
                state.gameStartTime = Date.now();
                document.getElementById('lock-screen').classList.add('hidden');
                document.getElementById('game-screen').classList.remove('hidden');
                updateGameTimer();
            }
        }

        function updateGameTimer() {
            if (document.getElementById('win-screen').classList.contains('hidden')) {
                const elapsed = Math.floor((Date.now() - state.gameStartTime) / 1000);
                const m = Math.floor(elapsed / 60).toString().padStart(2, '0');
                const s = (elapsed % 60).toString().padStart(2, '0');
                document.getElementById('timer-display').textContent = `${m}:${s}`;
                setTimeout(updateGameTimer, 1000);
            }
        }

        window.onload = init;
    </script>
</body>
</html>
