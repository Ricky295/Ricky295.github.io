<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>12x12 Sufufu</title>
<style>
body{background:#1a1a1a;font-family:Arial;color:#eee;text-align:center;margin:0;padding:10px}
h1{color:#333;font-size:2.5em;margin:20px 0}
.controls{max-width:400px;margin:0 auto 20px;background:#fff;padding:15px;border-radius:8px;color:#000}
.form-group{margin:10px 0;text-align:left}
label{display:block;margin-bottom:5px;font-weight:bold}
input[type="range"],input[type="number"]{width:100%;padding:5px;border:1px solid #ccc;border-radius:4px}
button{margin:5px;padding:8px 15px;font-size:14px;border:none;border-radius:6px;cursor:pointer;transition:all 0.2s}
.gen-btn{background:#007bff;color:#fff;font-weight:bold}
button:hover{opacity:0.9;transform:scale(1.02)}
table{border-collapse:collapse;margin:20px auto}
td{text-align:center;border:1px solid #eee;width:30px;height:30px}
.cell{display:flex;justify-content:center;align-items:center;background:#1a1a1a;cursor:pointer;font-size:16px;color:#fff}
.editable{color:#00f}
.selected{outline:2px solid #0066cc}
.candidates{display:none;grid-template-columns:repeat(3,1fr);grid-template-rows:repeat(2,1fr);width:100%;height:100%;font-size:8px}
.candidate{display:flex;justify-content:center;align-items:center;color:#666}
.candidate.active{color:#0066cc;font-weight:bold}
td:nth-child(4n){border-right:3px solid #eee}
td:nth-child(1),td:nth-child(9){border-left:3px solid #eee}
tr:nth-child(3n) td{border-bottom:3px solid #eee}
tr:nth-child(1) td{border-top:3px solid #eee}
.numpad{display:grid;grid-template-columns:repeat(3,1fr);gap:5px;max-width:200px;margin:10px auto}
.num-btn{background:#f2f2f2;border:1px solid #ccc;color:#000;padding:10px;cursor:pointer;border-radius:4px}
.num-btn:active{background:#d9d9d9}
.mode-btn{background:#e6e6e6;grid-column:span 3}
.clear-btn{background:#ffcccc;grid-column:span 3}
.highlight{background:#ffffcc!important;color:#000}
.candidate-highlight{color:#f60!important;font-weight:bold}
.error{background:#fcc!important}
#feedback{font-size:18px;font-weight:bold;margin:15px 0}
.green{color:#0a0}
.red{color:#f00}
@media (max-width:768px){
.puzzle-container{flex-direction:column}
.cell{width:25px;height:25px;font-size:14px}
.numpad{max-width:180px}
}
</style>
</head>
<body>
<h1>12×12 Sufufu</h1>

<div id="menu" class="controls">
<div class="form-group">
<label>Clues: <span id="clueValue">60</span></label>
<input type="range" id="clueRange" min="30" max="100" value="60" oninput="updateClues()">
<span>Difficulty: <span id="difficulty">Medium</span></span>
</div>
<button class="gen-btn" onclick="generate()">Generate Puzzle</button>
<button onclick="solve()">Show Solution</button>
<button onclick="print()">Print</button>
</div>

<div id="game" style="display:none">
<table id="table"></table>
<div class="numpad">
<div class="num-btn" onclick="input(1)">1</div>
<div class="num-btn" onclick="input(2)">2</div>
<div class="num-btn" onclick="input(3)">3</div>
<div class="num-btn" onclick="input(4)">4</div>
<div class="num-btn" onclick="input(5)">5</div>
<div class="num-btn" onclick="input(6)">6</div>
<div class="clear-btn" onclick="clear()">Clear</div>
<div class="mode-btn" onclick="toggleMode()" id="modeBtn">Normal</div>
</div>
<button onclick="check()">Check</button>
<button onclick="reset()">Reset</button>
<button onclick="backToMenu()">Back</button>
<div id="feedback"></div>
</div>

<p style="color:#fff;font-size:12px">Rules: Use digits 1-6 exactly twice per row, column, and 4×3 box. Same digits cannot touch orthogonally.</p>

<script>
let grid=[],solution=[],puzzle=[],selected=null,mode='normal',highlighted=null;

function updateClues(){
const v=document.getElementById('clueRange').value;
document.getElementById('clueValue').textContent=v;
const d=document.getElementById('difficulty');
if(v<40){d.textContent='Expert';d.style.color='#dc3545'}
else if(v<60){d.textContent='Hard';d.style.color='#fd7e14'}
else if(v<80){d.textContent='Medium';d.style.color='#ffc107'}
else{d.textContent='Easy';d.style.color='#28a745'}
}

function generateSolution(){
solution=Array(12).fill().map(()=>Array(12).fill(0));
if(fillGrid(0,0)){
grid=solution.map(r=>[...r]);
return true;
}
return false;
}

function fillGrid(row,col){
if(row===12)return true;
const nextCol=(col+1)%12;
const nextRow=nextCol===0?row+1:row;

const nums=[1,2,3,4,5,6].sort(()=>Math.random()-0.5);
for(let num of nums){
if(isValid(row,col,num)){
solution[row][col]=num;
if(fillGrid(nextRow,nextCol))return true;
solution[row][col]=0;
}
}
return false;
}

function isValid(r,c,n){
// Count in row
let rowCount=0;
for(let i=0;i<12;i++)if(solution[r][i]===n)rowCount++;
if(rowCount>=2)return false;

// Count in column
let colCount=0;
for(let i=0;i<12;i++)if(solution[i][c]===n)colCount++;
if(colCount>=2)return false;

// Count in 4x3 box
const boxR=Math.floor(r/3)*3;
const boxC=Math.floor(c/4)*4;
let boxCount=0;
for(let i=0;i<3;i++)
for(let j=0;j<4;j++)
if(solution[boxR+i][boxC+j]===n)boxCount++;
if(boxCount>=2)return false;

// Check adjacency
const dirs=[[-1,0],[1,0],[0,-1],[0,1]];
for(let[dr,dc] of dirs){
const nr=r+dr,nc=c+dc;
if(nr>=0&&nr<12&&nc>=0&&nc<12&&solution[nr][nc]===n)return false;
}

return true;
}

function createPuzzle(clues){
puzzle=grid.map(r=>[...r]);
const cells=[];
for(let r=0;r<12;r++)
for(let c=0;c<12;c++)
cells.push([r,c]);

cells.sort(()=>Math.random()-0.5);
let removed=0;
for(let[r,c] of cells){
if(removed>=144-clues)break;
puzzle[r][c]=0;
removed++;
}
}

function generate(){
if(!generateSolution())return;
const clues=parseInt(document.getElementById('clueRange').value);
createPuzzle(clues);
renderPuzzle();
document.getElementById('menu').style.display='none';
document.getElementById('game').style.display='block';
}

function renderPuzzle(){
const table=document.getElementById('table');
let html='';
for(let r=0;r<12;r++){
html+='<tr>';
for(let c=0;c<12;c++){
const val=puzzle[r][c];
const editable=val===0;
html+=`<td><div class="cell${editable?' editable':''}" data-r="${r}" data-c="${c}" onclick="selectCell(${r},${c})">${val||''}`;
html+='<div class="candidates">';
for(let i=1;i<=6;i++)html+=`<div class="candidate" data-v="${i}"></div>`;
html+='</div></div></td>';
}
html+='</tr>';
}
table.innerHTML=html;
}

function selectCell(r,c){
const cell=document.querySelector(`[data-r="${r}"][data-c="${c}"]`);
if(selected)selected.classList.remove('selected');
if(!cell.classList.contains('editable'))return;
selected=cell;
selected.classList.add('selected');
}

function input(num){
if(!selected)return;
const r=parseInt(selected.dataset.r);
const c=parseInt(selected.dataset.c);
if(mode==='normal'){
selected.textContent=num;
grid[r][c]=num;
clearCandidates(selected);
}else{
toggleCandidate(selected,num);
}
}

function clear(){
if(!selected)return;
const r=parseInt(selected.dataset.r);
const c=parseInt(selected.dataset.c);
if(mode==='normal'){
selected.textContent='';
grid[r][c]=0;
}else{
clearCandidates(selected);
}
}

function toggleCandidate(cell,num){
const candidates=cell.querySelector('.candidates');
candidates.style.display='grid';
cell.textContent='';
const r=parseInt(cell.dataset.r);
const c=parseInt(cell.dataset.c);
grid[r][c]=0;
const candidate=candidates.children[num-1];
if(candidate.classList.contains('active')){
candidate.textContent='';
candidate.classList.remove('active');
}else{
candidate.textContent=num;
candidate.classList.add('active');
}
}

function clearCandidates(cell){
const candidates=cell.querySelector('.candidates');
candidates.style.display='none';
for(let c of candidates.children){
c.textContent='';
c.classList.remove('active');
}
}

function toggleMode(){
mode=mode==='normal'?'candidate':'normal';
document.getElementById('modeBtn').textContent=mode==='normal'?'Normal':'Candidates';
}

function check(){
let errors=0,empty=0;
const feedback=document.getElementById('feedback');
document.querySelectorAll('.cell').forEach(cell=>{
cell.classList.remove('error');
const r=parseInt(cell.dataset.r);
const c=parseInt(cell.dataset.c);
const userVal=grid[r][c];
const correctVal=solution[r][c];
if(userVal===0)empty++;
else if(userVal!==correctVal){
cell.classList.add('error');
errors++;
}
});

if(errors===0){
if(empty===0){
feedback.textContent='Perfect! Puzzle solved!';
feedback.className='green';
}else{
feedback.textContent=`Good progress! ${empty} cells left.`;
feedback.className='green';
}
}else{
feedback.textContent=`${errors} errors found (highlighted in red).`;
feedback.className='red';
}
}

function reset(){
grid=puzzle.map(r=>[...r]);
renderPuzzle();
document.getElementById('feedback').textContent='';
}

function solve(){
grid=solution.map(r=>[...r]);
renderPuzzle();
}

function backToMenu(){
document.getElementById('menu').style.display='block';
document.getElementById('game').style.display='none';
}

function print(){
window.print();
}

// Initialize
updateClues();
grid=Array(12).fill().map(()=>Array(12).fill(0));

// Keyboard support
document.addEventListener('keydown',e=>{
if(!selected)return;
if(e.key>='1'&&e.key<='6')input(parseInt(e.key));
else if(e.key==='Delete'||e.key==='Backspace')clear();
});
</script>
</body>
</html>
