<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Favicon Snake Game</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            background: #1a1a1a;
            color: white;
            font-family: 'Courier New', monospace;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }
        
        .game-container {
            display: flex;
            gap: 40px;
            align-items: flex-start;
            margin-top: 20px;
        }
        
        .favicon-game {
            border: 4px solid #333;
            background: #000;
            image-rendering: pixelated;
            image-rendering: -moz-crisp-edges;
            image-rendering: crisp-edges;
        }
        
        .preview {
            transform: scale(8);
            transform-origin: top left;
            margin-right: 200px;
        }
        
        .actual-size {
            border: 2px solid #666;
        }
        
        .controls {
            text-align: center;
            margin-bottom: 20px;
        }
        
        .score {
            font-size: 18px;
            margin-bottom: 10px;
        }
        
        .instructions {
            font-size: 14px;
            opacity: 0.8;
            max-width: 300px;
            line-height: 1.4;
        }
        
        .game-over {
            color: #ff4444;
            font-weight: bold;
            margin-top: 10px;
        }
        
        .label {
            font-size: 12px;
            opacity: 0.6;
            margin-bottom: 5px;
        }
    </style>
</head>
<body>
    <h1>Favicon Snake Game</h1>
    
    <div class="controls">
        <div class="score">Score: <span id="score">0</span> | Level: <span id="level">5</span></div>
        <div class="instructions">
            Use WASD or Arrow Keys to move<br>
            Press SPACE to restart when game over<br>
            <small>URL params: ?level=10&showpreview=0</small>
        </div>
        <div id="gameOver" class="game-over" style="display: none;">
            Game Over! Press SPACE to restart
        </div>
    </div>
    
    <div class="game-container">
        <div>
            <div class="label">Preview (8x scale)</div>
            <canvas id="gameCanvas" class="favicon-game preview" width="32" height="32"></canvas>
        </div>
        
        <div>
            <div class="label">Actual favicon size (32x32)</div>
            <canvas id="faviconCanvas" class="favicon-game actual-size" width="32" height="32"></canvas>
        </div>
    </div>

    <script>
        class FaviconSnake {
            constructor() {
                // Parse URL parameters
                const urlParams = new URLSearchParams(window.location.search);
                this.level = parseInt(urlParams.get('level')) || 5;
                this.showPreview = urlParams.get('showpreview') === '0' ? false : true;
                
                // Calculate delay based on level (level tiles per second)
                this.gameDelay = 1000 / this.level;
                
                this.canvas = document.getElementById('gameCanvas');
                this.ctx = this.canvas.getContext('2d');
                this.faviconCanvas = document.getElementById('faviconCanvas');
                this.faviconCtx = this.faviconCanvas.getContext('2d');
                
                this.gridSize = 1; // 1 pixel per grid cell
                this.tileCount = 32; // 32x32 grid
                
                this.scoreElement = document.getElementById('score');
                this.gameOverElement = document.getElementById('gameOver');
                this.levelElement = document.getElementById('level');
                
                // Display current level
                this.levelElement.textContent = this.level;
                
                // Hide preview if needed
                if (!this.showPreview) {
                    const previewElement = document.querySelector('.game-container > div:first-child');
                    if (previewElement) {
                        previewElement.style.display = 'none';
                    }
                }
                
                this.reset();
                this.setupControls();
                this.gameLoop();
            }
            
            reset() {
                this.snake = [
                    {x: 16, y: 16}
                ];
                this.dx = 0;
                this.dy = 0;
                this.food = this.generateFood();
                this.score = 0;
                this.gameOver = false;
                this.gameStarted = false;
                this.scoreElement.textContent = this.score;
                this.gameOverElement.style.display = 'none';
            }
            
            generateFood() {
                let food;
                do {
                    food = {
                        x: Math.floor(Math.random() * this.tileCount),
                        y: Math.floor(Math.random() * this.tileCount)
                    };
                } while (this.snake.some(segment => segment.x === food.x && segment.y === food.y));
                return food;
            }
            
            setupControls() {
                document.addEventListener('keydown', (e) => {
                    if (this.gameOver && e.code === 'Space') {
                        this.reset();
                        return;
                    }
                    
                    if (this.gameOver) return;
                    
                    const key = e.code;
                    
                    // Prevent reverse direction (only if snake is moving)
                    if ((key === 'ArrowLeft' || key === 'KeyA') && this.dx !== 1) {
                        this.dx = -1;
                        this.dy = 0;
                        this.gameStarted = true;
                    } else if ((key === 'ArrowUp' || key === 'KeyW') && this.dy !== 1) {
                        this.dx = 0;
                        this.dy = -1;
                        this.gameStarted = true;
                    } else if ((key === 'ArrowRight' || key === 'KeyD') && this.dx !== -1) {
                        this.dx = 1;
                        this.dy = 0;
                        this.gameStarted = true;
                    } else if ((key === 'ArrowDown' || key === 'KeyS') && this.dy !== -1) {
                        this.dx = 0;
                        this.dy = 1;
                        this.gameStarted = true;
                    }
                });
            }
            
            update() {
                if (this.gameOver || !this.gameStarted) return;
                
                const head = {x: this.snake[0].x + this.dx, y: this.snake[0].y + this.dy};
                
                // Check wall collision
                if (head.x < 0 || head.x >= this.tileCount || head.y < 0 || head.y >= this.tileCount) {
                    this.gameOver = true;
                    this.gameOverElement.style.display = 'block';
                    return;
                }
                
                // Check self collision
                if (this.snake.some(segment => segment.x === head.x && segment.y === head.y)) {
                    this.gameOver = true;
                    this.gameOverElement.style.display = 'block';
                    return;
                }
                
                this.snake.unshift(head);
                
                // Check food collision
                if (head.x === this.food.x && head.y === this.food.y) {
                    this.score++;
                    this.scoreElement.textContent = this.score;
                    this.food = this.generateFood();
                } else {
                    this.snake.pop();
                }
            }
            
            draw() {
                // Clear both canvases
                this.ctx.fillStyle = '#000000';
                this.ctx.fillRect(0, 0, 32, 32);
                
                this.faviconCtx.fillStyle = '#000000';
                this.faviconCtx.fillRect(0, 0, 32, 32);
                
                // Draw snake
                this.ctx.fillStyle = '#00ff00';
                this.faviconCtx.fillStyle = '#00ff00';
                
                this.snake.forEach((segment, index) => {
                    const x = segment.x * this.gridSize;
                    const y = segment.y * this.gridSize;
                    
                    // Head is brighter
                    if (index === 0) {
                        this.ctx.fillStyle = '#66ff66';
                        this.faviconCtx.fillStyle = '#66ff66';
                    } else {
                        this.ctx.fillStyle = '#00ff00';
                        this.faviconCtx.fillStyle = '#00ff00';
                    }
                    
                    this.ctx.fillRect(x, y, this.gridSize, this.gridSize);
                    this.faviconCtx.fillRect(x, y, this.gridSize, this.gridSize);
                });
                
                // Draw food
                this.ctx.fillStyle = '#ff0000';
                this.faviconCtx.fillStyle = '#ff0000';
                
                const foodX = this.food.x * this.gridSize;
                const foodY = this.food.y * this.gridSize;
                
                this.ctx.fillRect(foodX, foodY, this.gridSize, this.gridSize);
                this.faviconCtx.fillRect(foodX, foodY, this.gridSize, this.gridSize);
                
                // Add some pixels for visual interest when game is over
                if (this.gameOver) {
                    this.ctx.fillStyle = '#ff4444';
                    this.faviconCtx.fillStyle = '#ff4444';
                    
                    // Draw border flash
                    for (let i = 0; i < 32; i++) {
                        if (i % 4 < 2) {
                            this.ctx.fillRect(i, 0, 1, 1);
                            this.ctx.fillRect(i, 31, 1, 1);
                            this.ctx.fillRect(0, i, 1, 1);
                            this.ctx.fillRect(31, i, 1, 1);
                            
                            this.faviconCtx.fillRect(i, 0, 1, 1);
                            this.faviconCtx.fillRect(i, 31, 1, 1);
                            this.faviconCtx.fillRect(0, i, 1, 1);
                            this.faviconCtx.fillRect(31, i, 1, 1);
                        }
                    }
                }
            }
            
            gameLoop() {
                this.update();
                this.draw();
                setTimeout(() => this.gameLoop(), this.gameOver ? 500 : this.gameDelay);
            }
        }
        
        // Start the game
        new FaviconSnake();
    </script>
</body>
</html>
