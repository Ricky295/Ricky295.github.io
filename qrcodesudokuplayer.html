<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sudoku Flux Player</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&display=swap');
        
        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background: #0f172a;
            color: #f8fafc;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 1rem;
        }

        /* The Grid Container */
        .sudoku-container {
            width: 100%;
            max-width: 450px;
            background: #4f46e5; /* Main border color */
            padding: 2px;
            border-radius: 8px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.5);
            display: grid;
            gap: 1px; /* Thin internal lines */
        }

        .cell {
            background: #1e293b;
            aspect-ratio: 1 / 1;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: clamp(1rem, 5vw, 1.5rem);
            font-weight: 800;
            cursor: pointer;
            transition: all 0.1s;
            user-select: none;
        }

        .cell:hover:not(.fixed) { background: #334155; }
        .cell.selected { background: #6366f1 !important; color: white; }
        .cell.fixed { background: #0f172a; color: #94a3b8; cursor: default; }
        .cell.error { color: #f87171; }

        /* Thick Borders for 9x9 */
        .grid-9 .cell:nth-child(3n):not(:nth-child(9n)) { border-right: 3px solid #4f46e5; }
        .grid-9 .cell:nth-child(n+19):nth-child(-n+27),
        .grid-9 .cell:nth-child(n+46):nth-child(-n+54) { border-bottom: 3px solid #4f46e5; }

        /* Thick Borders for 6x6 */
        .grid-6 .cell:nth-child(3n):not(:nth-child(6n)) { border-right: 3px solid #4f46e5; }
        .grid-6 .cell:nth-child(n+13):nth-child(-n+18),
        .grid-6 .cell:nth-child(n+31):nth-child(-n+36) { border-bottom: 3px solid #4f46e5; }

        .numpad-btn {
            background: #1e293b;
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 12px;
            height: 50px;
            font-weight: 800;
            transition: transform 0.1s, background 0.2s;
        }
        .numpad-btn:active { transform: scale(0.9); background: #6366f1; }
    </style>
</head>
<body>

    <header class="w-full max-w-md flex justify-between items-center mb-8">
        <div>
            <h1 class="text-3xl font-extrabold tracking-tight text-white">Sudoku <span class="text-indigo-500">Flux</span></h1>
            <div class="flex gap-2 items-center mt-1">
                <span id="puzzle-label" class="text-xs font-bold text-slate-500 uppercase">Puzzle 1</span>
                <span id="difficulty-badge" class="bg-indigo-500/20 text-indigo-400 text-[10px] px-2 py-0.5 rounded-full border border-indigo-500/30 font-bold">0% Difficulty</span>
            </div>
        </div>
        <div class="flex gap-2">
            <button onclick="changePuzzle(-1)" class="p-2 rounded-full bg-slate-800 hover:bg-slate-700 transition">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M15 19l-7-7 7-7" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
            </button>
            <button onclick="changePuzzle(1)" class="p-2 rounded-full bg-slate-800 hover:bg-slate-700 transition">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M9 5l7 7-7 7" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
            </button>
        </div>
    </header>

    <div id="grid" class="sudoku-container mb-8"></div>

    <div class="w-full max-w-md space-y-4">
        <div id="numpad" class="grid grid-cols-5 gap-2"></div>
        <div class="flex gap-2">
            <button onclick="clearCell()" class="flex-1 py-4 rounded-2xl bg-slate-800 font-bold text-slate-400 hover:text-white transition">Clear</button>
            <button onclick="checkPuzzle()" class="flex-1 py-4 rounded-2xl bg-indigo-600 font-bold hover:bg-indigo-500 transition shadow-lg shadow-indigo-500/30">Verify</button>
        </div>
    </div>

    <div id="toast" class="fixed bottom-8 bg-white text-slate-900 px-6 py-3 rounded-full font-bold shadow-2xl opacity-0 transition-all pointer-events-none"></div>

    <script>
        let puzzles = [];
        let currentIndex = 0;
        let selectedIdx = null;
        let currentGrid = [];

        window.onload = () => {
            const params = new URLSearchParams(window.location.search);
            let raw = params.get('puzzles');
            if (!raw) return showToast("No puzzles found in URL.");

            // Decode if base64
            try { if (!raw.includes(',')) raw = atob(raw); } catch(e) {}

            puzzles = raw.split(',').filter(s => s.length === 81 || s.length === 36);
            if (puzzles.length) loadPuzzle(0);
        };

        function loadPuzzle(idx) {
            currentIndex = idx;
            const str = puzzles[idx];
            const size = str.length === 81 ? 9 : 6;
            
            currentGrid = str.split('').map(v => ({
                val: parseInt(v),
                isFixed: v !== '0',
                userInput: 0
            }));

            renderGrid(size);
            updateInfo(size);
        }

        function renderGrid(size) {
            const container = document.getElementById('grid');
            container.className = `sudoku-container grid-${size}`;
            container.style.gridTemplateColumns = `repeat(${size}, 1fr)`;
            container.innerHTML = '';

            currentGrid.forEach((cell, i) => {
                const div = document.createElement('div');
                div.className = `cell ${cell.isFixed ? 'fixed' : ''}`;
                div.textContent = cell.isFixed ? cell.val : '';
                div.onclick = () => selectCell(i, div);
                container.appendChild(div);
            });

            const pad = document.getElementById('numpad');
            pad.innerHTML = '';
            for (let i = 1; i <= size; i++) {
                const btn = document.createElement('button');
                btn.className = 'numpad-btn';
                btn.textContent = i;
                btn.onclick = () => enterNumber(i);
                pad.appendChild(btn);
            }
        }

        function selectCell(idx, el) {
            if (currentGrid[idx].isFixed) return;
            document.querySelectorAll('.cell').forEach(c => c.classList.remove('selected'));
            el.classList.add('selected');
            selectedIdx = idx;
        }

        function enterNumber(num) {
            if (selectedIdx === null) return;
            currentGrid[selectedIdx].userInput = num;
            const cells = document.querySelectorAll('.cell');
            cells[selectedIdx].textContent = num;
            cells[selectedIdx].classList.remove('error');
        }

        function clearCell() {
            if (selectedIdx === null) return;
            currentGrid[selectedIdx].userInput = 0;
            document.querySelectorAll('.cell')[selectedIdx].textContent = '';
        }

        function updateInfo(size) {
            document.getElementById('puzzle-label').textContent = `Puzzle ${currentIndex + 1} of ${puzzles.length} (${size}x${size})`;
            
            // Calculate Difficulty: (Empty Cells / Total Cells) * 100
            const clues = currentGrid.filter(c => c.isFixed).length;
            const total = size * size;
            const difficulty = Math.max(5, (1 - (clues / total)) * 100).toFixed(1);
            document.getElementById('difficulty-badge').textContent = `${difficulty}% Difficulty`;
            selectedIdx = null;
        }

        function changePuzzle(dir) {
            let next = currentIndex + dir;
            if (next >= 0 && next < puzzles.length) loadPuzzle(next);
        }

        function checkPuzzle() {
            const size = Math.sqrt(currentGrid.length) || 6;
            const values = currentGrid.map(c => c.isFixed ? c.val : c.userInput);
            
            if (values.includes(0)) return showToast("Finish the puzzle first!");

            let errors = false;
            // Basic check for rows/cols
            for (let i = 0; i < size; i++) {
                let row = [], col = [];
                for (let j = 0; j < size; j++) {
                    row.push(values[i * size + j]);
                    col.push(values[j * size + i]);
                }
                if (new Set(row).size !== size || new Set(col).size !== size) errors = true;
            }

            showToast(errors ? "There are mistakes!" : "Perfect! You solved it!");
        }

        function showToast(msg) {
            const t = document.getElementById('toast');
            t.textContent = msg;
            t.style.opacity = '1';
            t.style.transform = 'translateY(-20px)';
            setTimeout(() => {
                t.style.opacity = '0';
                t.style.transform = 'translateY(0)';
            }, 3000);
        }

        document.addEventListener('keydown', (e) => {
            if (e.key >= '1' && e.key <= '9') enterNumber(parseInt(e.key));
            if (e.key === 'Backspace' || e.key === 'Delete') clearCell();
        });
    </script>
</body>
</html>
